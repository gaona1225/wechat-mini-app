"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _pass_config=require("../pass_config"),_pass_utilsToastFn=require("../pass_utils/toastFn"),_pass_utilsApiAjax=require("../pass_utils/apiAjax"),RsaObject=require("../dep/RSA"),RSA="B3C61EBBA4659C4CE3639287EE871F1F48F7930EA977991C7AFE3CC442FEA49643212E7D570C853F368065CC57A2014666DA8AE7D493FD47D171C0D894EEE3ED7F99F6798B7FFD7B5873227038AD23E3197631A8CB642213B9F27D4901AB0D92BFA27542AE890855396ED92775255C977F5C302F1E7ED4B1E369C12CB6B1822F",regNamePwdSucc=function(e,s){var a=e.data;if(140001==a.ppErrorInfo.errNo)wx.setStorage({key:"userInfo",data:{bduss:a.ppUser.bduss,waimai_stoken:a.ppUser.waimai_stoken,stoken:a.ppUser.stoken},success:function(){var e=null,s=getCurrentPages();try{e=wx.getStorageSync("pageStackLength"),e&&wx.navigateBack({delta:s.length-e+1})}catch(a){console.log(a)}},fail:function(){console.log("setStorage fail")}});else if(0==a.ppErrorInfo.errNo){var t=void 0,r=getCurrentPages();try{t=wx.getStorageSync("pageStackLength"),t&&wx.navigateBack({delta:r.length-t+1})}catch(o){console.log(o)}}else _pass_utilsToastFn.toastFn(s,a.ppErrorInfo.msg)},regNamePwd=function(e){var s=e.data||{},a=s.telnum&&s.telnum.replace(/[ ]/g,""),t=void 0,r=void 0,o=void 0,n=void 0,i=void 0,p=void 0,c=void 0,g={tpl:_pass_config.tpl,action:"login",sms:1,smsverify:1,clientfrom:"wap",is_voice_sms:"0",wechat:1};try{var u=wx.getStorageSync("userInfo");u&&(n=u.stoken,i=u.bduss,p=u.authsid,c=u.bdstoken)}catch(d){console.log(d)}try{RsaObject.setMaxDigits(131),r=new RsaObject.RSAKeyPair("10001","",RSA),o=RsaObject.encryptedString(r,s.password)}catch(d){console.log(d)}1==s.notRegist?(t="wp/api/login",e.setData({respErrno:140001}),g.setuname=s.user_name?s.user_name:"",g.setpwd=o?o:"",g.BDUSS=i?i:"",g.STOKEN=n?n:"",g.username=a?a:"",g.password=s.smsCode?s.smsCode:""):400412==s.errNo?(t="v3/getpass/api/showsetpwdusername/?v="+(new Date).getTime(),e.setData({respErrno:0}),g.password=o?o:"",g.username=s.user_name?s.user_name:"",g.bdstoken=c?c:"",g.authsid=p?p:"",g.BDUSS=i?i:"",g.STOKEN=n?n:""):400410==s.errNo&&(t="/v3/getpass/api/setpwd/?v="+(new Date).getTime(),e.setData({respErrno:0}),g.password=o?o:"",g.bdstoken=c?c:"",g.authsid=p?p:"",g.BDUSS=i?i:"",g.STOKEN=n?n:""),_pass_utilsApiAjax.apiAjax(t,g,"POST",regNamePwdSucc,e)};exports.regNamePwd=regNamePwd;